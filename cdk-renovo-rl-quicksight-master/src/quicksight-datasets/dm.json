{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Generated by AWS QuickSight for export-dm-latest started at 2025-02-19 18:28:25 UTC",
  "Parameters": {
    "RenovoLiveEnv": {
      "Type": "String",
      "Description": "RenovoLive Environment"
    },
    "Database": {
      "Type": "String",
      "Description": "Database name"
    },
    "DataSourceArn": {
      "Type": "String",
      "Description": "Data source ARN"
    },
    "FolderArn": {
      "Type": "String",
      "Description": "Folder ARN"
    },
    "ManagingPrincipal": {
      "Type": "String",
      "Description": "Managing principal"
    },
    "RowLevelPermissionsDataSetArn": {
      "Type": "String",
      "Description": "Row Level Permission DataSet ARN"
    }
  },
  "Resources": {
    "vqsdm": {
      "Type": "AWS::QuickSight::DataSet",
      "Properties": {
        "AwsAccountId": {
          "Fn::Sub": "${AWS::AccountId}"
        },
        "DataSetId": {
          "Fn::Sub": "${RenovoLiveEnv}_${Database}_v_qs_dm"
        },
        "Name": {
          "Fn::Sub": "${RenovoLiveEnv}_${Database}_v_qs_dm"
        },
        "RowLevelPermissionDataSet": {
          "Arn": {
            "Fn::Sub": "${RowLevelPermissionsDataSetArn}"
          },
          "Status": "ENABLED",
          "PermissionPolicy": "GRANT_ACCESS"
        },
        "Permissions": [{
          "Actions": [
            "quicksight:DescribeDataSet",
            "quicksight:DescribeDataSetPermissions",
            "quicksight:PassDataSet",
            "quicksight:DescribeIngestion",
            "quicksight:ListIngestions",
            "quicksight:UpdateDataSet",
            "quicksight:DeleteDataSet",
            "quicksight:CreateIngestion",
            "quicksight:CancelIngestion",
            "quicksight:UpdateDataSetPermissions"
          ],
            "Principal": {
            "Fn::Sub": "${ManagingPrincipal}"
          }
        }],
        "FolderArns": [
          {
            "Fn::Sub": "${FolderArn}"
          }
        ],
        "DataSetRefreshProperties": {
          "RefreshConfiguration": {
            "IncrementalRefresh": {
              "LookbackWindow": {
                "ColumnName": "se_lastupdatedutc",
                "Size": 52,
                "SizeUnit": "WEEK"
              }
            }
          }
        },
        "DataSetUsageConfiguration" : {
          "DisableUseAsDirectQuerySource" : false,
          "DisableUseAsImportedSource" : false
        },
        "DatasetParameters" : [ {
          "DecimalDatasetParameter" : {
            "DefaultValues" : {
              "StaticValues" : [ 3191.0 ]
            },
            "Id" : "368d9e65-197f-4a8a-8d04-7a65fd08d5f5",
            "Name" : "UserID",
            "ValueType" : "SINGLE_VALUED"
          }
        } ],
        "FieldFolders" : {
          "Calculations" : {
            "Columns" : [ "Age", "Days To Close", "Accidental Damage KPI", "95% Target", "3% Target", "User Errors KPI", "5% Target", "2% Target", "Cannot Duplicate KPI", "Equipment Repair KPI", "5 Day Target", "Days Open" ]
          }
        },
        "ImportMode": "SPICE",
        "LogicalTableMap" : {
          "vqsdm" : {
            "Alias" : "v_qs_dm",
            "DataTransforms" : [ {
              "CastColumnTypeOperation" : {
                "ColumnName" : "system_id",
                "NewColumnType" : "STRING"
              }
            }, {
              "CastColumnTypeOperation" : {
                "ColumnName" : "facility_id",
                "NewColumnType" : "STRING"
              }
            }, {
              "CastColumnTypeOperation" : {
                "ColumnName" : "client_id",
                "NewColumnType" : "STRING"
              }
            }, {
              "CastColumnTypeOperation" : {
                "ColumnName" : "region_id",
                "NewColumnType" : "STRING"
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "f08ae171-18ec-4c51-a44a-5c2b44ef628e",
                  "ColumnName" : "Age",
                  "Expression" : "ifelse(\r\n  {status} = 'Closed' AND dateDiff({receiveddate}, {se_completedutc}) = 0,\r\n  1,\r\n  ifelse(\r\n    {status} = 'Closed',\r\n    dateDiff({receiveddate}, {se_completedutc}),\r\n    ifelse(\r\n      dateDiff({receiveddate}, now()) = 0,\r\n      1,\r\n      dateDiff({receiveddate}, now())\r\n    )\r\n  )\r\n)"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "9eeab72c-40de-43e6-a1ba-fb8cee8ae148",
                  "ColumnName" : "Days To Close",
                  "Expression" : "dateDiff(receiveddate,{se_completedutc})"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "a0164dcd-82b5-4fb8-9d10-adc0d145ce3e",
                  "ColumnName" : "se_sm",
                  "Expression" : "receiveddate"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "0b6ec35d-f137-4370-8895-8bc08876c665",
                  "ColumnName" : "Accidental Damage KPI",
                  "Expression" : "countIf(serviceeventid,{sestat_name}='Accidental Damage') / countIf(serviceeventid, {symptom} <> 'Recall/Alert Related' and {symptom} <> 'Incoming Inspection' and {se_initiatedby} = 1)"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "fc6f6c1f-581a-43c1-b337-ed2aca574b30",
                  "ColumnName" : "3% Target",
                  "Expression" : "0.03"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "8e5a12b8-fc44-4f83-aa54-e57138619045",
                  "ColumnName" : "User Errors KPI",
                  "Expression" : "countIf(serviceeventid,{sestat_name}='Operator Error') / countIf(serviceeventid, {symptom} <> 'Recall/Alert Related' and {symptom} <> 'Incoming Inspection' and {se_initiatedby} = 1)"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "6e67a4a5-4a8b-40c0-94cc-93d0afe74d2f",
                  "ColumnName" : "Cannot Duplicate KPI",
                  "Expression" : "countIf(serviceeventid,{sestat_name}='Cannot Duplicate') / countIf(serviceeventid, {symptom} <> 'Recall/Alert Related' and {symptom} <> 'Incoming Inspection' and {se_initiatedby} = 1)"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "fe092785-717b-4458-a8bb-1c09a570c0a5",
                  "ColumnName" : "2% Target",
                  "Expression" : "0.02    "
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "81b6d61f-6cd7-42ab-b0cd-bd96ef5d6c9e",
                  "ColumnName" : "5% Target",
                  "Expression" : "0.05"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "8d2da324-a497-4e2b-b042-d43402b191f4",
                  "ColumnName" : "95% Target",
                  "Expression" : "0.95"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "6b836de1-dddf-4943-8dbb-2962f34b5868",
                  "ColumnName" : "Manufacter Recalls",
                  "Expression" : "countIf(serviceeventid,{sestat_name}='Manufacturer Alert/Recall')"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "6d62779b-6681-408d-9d51-6b884fc4e21d",
                  "ColumnName" : "userid",
                  "Expression" : "${UserID}"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "e152543e-f0f9-416d-9c33-db2d42380fa1",
                  "ColumnName" : "Equipment Repair KPI",
                  "Expression" : "countIf(serviceeventid,(status='Completed' or status='Closed') and {symptom} <> 'Recall/Alert Related' and {symptom} <> 'Incoming Inspection' and {se_initiatedby} = 1) / countIf(serviceeventid, {symptom} <> 'Recall/Alert Related' and {symptom} <> 'Incoming Inspection' and {se_initiatedby} = 1)"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "4de192b7-9b38-4eec-9338-2fe3b64d4274",
                  "ColumnName" : "Closed within 5 Days",
                  "Expression" : "countIf(serviceeventid,status='Closed') / count(serviceeventid)"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "5aadc707-40fd-40bf-82d1-e476856b323e",
                  "ColumnName" : "5 Day Target",
                  "Expression" : "5"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "40b29b8b-39ad-48c0-b43b-47aede81d1d4",
                  "ColumnName" : "Days Open",
                  "Expression" : "ifelse(\r\n    {status} = 'Completed', dateDiff({receiveddate}, {se_workcompletedutc}), dateDiff({receiveddate}, now())\r\n    )"
                } ]
              }
            }, {
              "CreateColumnsOperation" : {
                "Columns" : [ {
                  "ColumnId" : "3d40041f-9d85-4c4f-991b-09ed6beb62df",
                  "ColumnName" : "Days to Close (use for Same Day)",
                  "Expression" : "dateDiff(receiveddate,{se_completedutc_date})"
                } ]
              }
            }, {
              "ProjectOperation" : {
                "ProjectedColumns" : [ "system_id", "facility_id", "client_id", "region_id", "system_name", "facility", "costcenter", "receiveddate", "se_workcompletedutc", "serviceeventid", "se_no", "status", "cetagno", "serialnumber", "location", "facassetnumber", "ismissioncritical", "device", "manufacturer", "model", "smdm", "is_incoming_inspection", "smsched", "se_initiatedby", "technician", "po_number", "specialcondition", "se_status", "se_completedutc", "se__sm", "priority", "problem", "problem_text", "resolution", "resolutioncode", "symptom", "diagnosis", "parts_used", "sestat_name", "daystoresolution", "locationkey", "l_sespecialconditionid", "parts_qty_ordered", "parts_qty_received", "se_lastupdatedutc", "se_completedutc_date", "Age", "Days To Close", "se_sm", "Accidental Damage KPI", "3% Target", "User Errors KPI", "Cannot Duplicate KPI", "2% Target", "5% Target", "95% Target", "Manufacter Recalls", "userid", "Equipment Repair KPI", "Closed within 5 Days", "5 Day Target", "Days Open", "Days to Close (use for Same Day)" ]
              }
            } ],
            "Source" : {
              "PhysicalTableId" : "vqsdm"
            }
          }
        },
        "PhysicalTableMap" : {
          "vqsdm" : {
            "RelationalTable" : {
              "DataSourceArn": {
                "Fn::Sub": "${DataSourceArn}"
              },
              "InputColumns" : [ {
                "Name" : "system_id",
                "Type" : "INTEGER"
              }, {
                "Name" : "facility_id",
                "Type" : "INTEGER"
              }, {
                "Name" : "client_id",
                "Type" : "INTEGER"
              }, {
                "Name" : "region_id",
                "Type" : "INTEGER"
              }, {
                "Name" : "system_name",
                "Type" : "STRING"
              }, {
                "Name" : "facility",
                "Type" : "STRING"
              }, {
                "Name" : "costcenter",
                "Type" : "STRING"
              }, {
                "Name" : "receiveddate",
                "Type" : "DATETIME"
              }, {
                "Name" : "se_workcompletedutc",
                "Type" : "DATETIME"
              }, {
                "Name" : "serviceeventid",
                "Type" : "INTEGER"
              }, {
                "Name" : "se_no",
                "Type" : "STRING"
              }, {
                "Name" : "status",
                "Type" : "STRING"
              }, {
                "Name" : "cetagno",
                "Type" : "STRING"
              }, {
                "Name" : "serialnumber",
                "Type" : "STRING"
              }, {
                "Name" : "location",
                "Type" : "STRING"
              }, {
                "Name" : "facassetnumber",
                "Type" : "STRING"
              }, {
                "Name" : "ismissioncritical",
                "Type" : "BIT"
              }, {
                "Name" : "device",
                "Type" : "STRING"
              }, {
                "Name" : "manufacturer",
                "Type" : "STRING"
              }, {
                "Name" : "model",
                "Type" : "STRING"
              }, {
                "Name" : "smdm",
                "Type" : "STRING"
              }, {
                "Name" : "is_incoming_inspection",
                "Type" : "BIT"
              }, {
                "Name" : "smsched",
                "Type" : "STRING"
              }, {
                "Name" : "se_initiatedby",
                "Type" : "INTEGER"
              }, {
                "Name" : "technician",
                "Type" : "STRING"
              }, {
                "Name" : "po_number",
                "Type" : "STRING"
              }, {
                "Name" : "specialcondition",
                "Type" : "STRING"
              }, {
                "Name" : "se_status",
                "Type" : "STRING"
              }, {
                "Name" : "se_completedutc",
                "Type" : "DATETIME"
              }, {
                "Name" : "se__sm",
                "Type" : "STRING"
              }, {
                "Name" : "priority",
                "Type" : "STRING"
              }, {
                "Name" : "problem",
                "Type" : "STRING"
              }, {
                "Name" : "problem_text",
                "Type" : "STRING"
              }, {
                "Name" : "resolution",
                "Type" : "STRING"
              }, {
                "Name" : "resolutioncode",
                "Type" : "STRING"
              }, {
                "Name" : "symptom",
                "Type" : "STRING"
              }, {
                "Name" : "diagnosis",
                "Type" : "STRING"
              }, {
                "Name" : "parts_used",
                "Type" : "INTEGER"
              }, {
                "Name" : "sestat_name",
                "Type" : "STRING"
              }, {
                "Name" : "daystoresolution",
                "Type" : "INTEGER"
              }, {
                "Name" : "locationkey",
                "Type" : "STRING"
              }, {
                "Name" : "l_sespecialconditionid",
                "Type" : "INTEGER"
              }, {
                "Name" : "parts_qty_ordered",
                "SubType" : "FIXED",
                "Type" : "DECIMAL"
              }, {
                "Name" : "parts_qty_received",
                "SubType" : "FIXED",
                "Type" : "DECIMAL"
              }, {
                "Name" : "se_lastupdatedutc",
                "Type" : "DATETIME"
              }, {
                "Name" : "se_completedutc_date",
                "Type" : "DATETIME"
              } ],
              "Name" : "v_qs_dm",
              "Schema": {
                "Fn::Sub": "${Database}"
              }
            }
          }
        }
      }
    }
  }
}